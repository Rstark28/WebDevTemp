<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Tic Tac Tango</title>
    <link rel="stylesheet" href="static/css/ttt.css">
</head>

<body>

    <h1>The Tic Tac Tango</h1>
    <div id="turn">Start The Game To Play</div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const NUM_SQUARES = 9;

        document.write('<div class="board">');
        for (let i = 0; i < NUM_SQUARES; i++) {
            let id = "sq" + i;
            document.write("<div class='square' id='" + id + "'></div>");
        }
        document.write('</div>');
    </script>

    <div id="condition">No Winner Yet</div>
    <button id="start-game">Start Game</button>


    <script>
        const winConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        function resetBoard() {
            currPlayer = Math.random() < 0.5 ? 'X' : 'O';
            document.getElementById('turn').innerText = `${currPlayer}'s Turn`;
            document.getElementById('condition').innerText = 'No Winner Yet';
            $('#condition').css('background-color', '#abb5df');
            for (i = 0; i < NUM_SQUARES; i++) {
                document.getElementById('sq' + i).innerText = '';
            }
        }

        function makeMove(event) {
            let square = event.target;
            if (square.innerText === '') {
                square.innerText = currPlayer;
                alert(`Square ${square.id.replace('sq', '')} clicked`);
                const currBoard = Array.from(document.querySelectorAll('.square')).map(sq => sq.innerText);
                const result = checkWin(currBoard);
                result ? handleResult(result) : changeTurn();
            }

        }

        function changeTurn() {
            currPlayer = currPlayer === 'X' ? 'O' : 'X';
            document.getElementById('turn').innerText = `${currPlayer}'s Turn`;
        }

        function checkWin(currBoard) {
            for (i = 0; i < winConditions.length; i++) {
                const [a, b, c] = winConditions[i];
                if (currBoard[a] && currBoard[a] === currBoard[b] && currBoard[a] === currBoard[c]) {
                    return currBoard[a];
                }
            }
            return currBoard.includes('') ? null : 'S';
        }

        function handleResult(result) {
            if (result === 'S') {
                document.getElementById('condition').innerText = 'Stalemate';
                $('#condition').css('background-color', '#ffee8b');
            } else {
                document.getElementById('condition').innerText = `${result} Wins!`;
                $('#condition').css('background-color', '#92d9a2');
            }
            document.getElementById('turn').innerText = `Game Over, Start A New Game`;
            for (i = 0; i < NUM_SQUARES; i++) {
                document.getElementById('sq' + i).removeEventListener('click', makeMove);
            }
        }

        document.getElementById('start-game').onclick = function () {
            for (i = 0; i < NUM_SQUARES; i++) {
                document.getElementById('sq' + i).addEventListener('click', makeMove);
            }
            resetBoard();
        };
    </script>

</body>

</html>